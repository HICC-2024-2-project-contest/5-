<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[[${productCategory}]] - í¸ì˜ì  ë¹„êµì™•</title>
    <link rel="stylesheet" th:href="@{/css/category.css}">
</head>
<body>

<header>
    <div class="header-container">
        <div class="header-left">
            <h1 class="title">í¸ì˜ì  ë¹„êµì™•</h1>
            <div class="logo-container">
                <img src="cu-logo.png" alt="CU ë¡œê³ " class="logo">
                <span class="separator"></span>
                <img src="gs25-logo.png" alt="GS25 ë¡œê³ " class="logo">
                <span class="separator"></span>
                <img src="7eleven-logo.png" alt="7-Eleven ë¡œê³ " class="logo">
            </div>
        </div>
        <div class="header-right">
            <div class="search-auth-container">
                <div class="search-bar">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." class="search-input">
                </div>
                <div class="auth-buttons">
                    <button class="auth-btn">ë¡œê·¸ì¸</button>
                    <span>|</span>
                    <button class="auth-btn">íšŒì›ê°€ì…</button>
                </div>
            </div>
        </div>
    </div>
</header>
<nav>
    <ul class="category-menu">
        <li><a href="/category/lunch" class="category-item" th:classappend="${productCategory == 'lunch' ? 'active' : ''}">ë„ì‹œë½</a></li>
        <li><a href="/category/sandwich_hamburger" class="category-item" th:classappend="${productCategory == 'sandwich_hamburger' ? 'active' : ''}">ìƒŒë“œìœ„ì¹˜Â·í–„ë²„ê±°</a></li>
        <li><a href="/category/rice_ball" class="category-item" th:classappend="${productCategory == 'rice_ball' ? 'active' : ''}">ì£¼ë¨¹ë°¥Â·ê¹€ë°¥</a></li>
        <li><a href="/category/fried" class="category-item" th:classappend="${productCategory == 'fried' ? 'active' : ''}">íŠ€ê¹€ë¥˜</a></li>
        <li><a href="/category/bakery" class="category-item" th:classappend="${productCategory == 'bakery' ? 'active' : ''}">ë² ì´ì»¤ë¦¬</a></li>
        <li><a href="/category/instant_coffee" class="category-item" th:classappend="${productCategory == 'instant_coffee' ? 'active' : ''}">ì¦‰ì„ì»¤í”¼</a></li>
        <li><a href="/category/snack" class="category-item" th:classappend="${productCategory == 'snack' ? 'active' : ''}">ìŠ¤ë‚µÂ·ë¹„ìŠ¤ì¼“</a></li>
        <li><a href="/category/bread_dessert" class="category-item" th:classappend="${productCategory == 'bread_dessert' ? 'active' : ''}">ë¹µÂ·ë””ì €íŠ¸</a></li>
        <li><a href="/category/candy_choco" class="category-item" th:classappend="${productCategory == 'candy_choco' ? 'active' : ''}">ê»ŒÂ·ì´ˆì½œë¦¿Â·ìº”ë””</a></li>
        <li><a href="/category/ice_cream" class="category-item" th:classappend="${productCategory == 'ice_cream' ? 'active' : ''}">ì•„ì´ìŠ¤í¬ë¦¼</a></li>
        <li><a href="/category/processed_food" class="category-item" th:classappend="${productCategory == 'processed_food' ? 'active' : ''}">ê°€ê³µì‹ì‚¬</a></li>
        <li><a href="/category/alcohol_snack" class="category-item" th:classappend="${productCategory == 'alcohol_snack' ? 'active' : ''}">ì•ˆì£¼ë¥˜</a></li>
        <li><a href="/category/ingredients" class="category-item" th:classappend="${productCategory == 'ingredients' ? 'active' : ''}">ì‹ì¬ë£Œ</a></li>
        <li><a href="/category/drink" class="category-item" th:classappend="${productCategory == 'drink' ? 'active' : ''}">ìŒë£Œ</a></li>
        <li><a href="/category/ice_drink" class="category-item" th:classappend="${productCategory == 'ice_drink' ? 'active' : ''}">ì•„ì´ìŠ¤ë“œë§í¬</a></li>
        <li><a href="/category/dairy" class="category-item" th:classappend="${productCategory == 'dairy' ? 'active' : ''}">ìœ ì œí’ˆ</a></li>
        <li><a href="/category/hobby" class="category-item" th:classappend="${productCategory == 'hobby' ? 'active' : ''}">ì·¨ë¯¸Â·ë ˆì €</a></li>
        <li><a href="/category/medicine" class="category-item" th:classappend="${productCategory == 'medicine' ? 'active' : ''}">ì˜ì•½ì™¸í’ˆ</a></li>
        <li><a href="/category/personal" class="category-item" th:classappend="${productCategory == 'personal' ? 'active' : ''}">ì‹ ë³€ì¡í™”</a></li>
        <li><a href="/category/household" class="category-item" th:classappend="${productCategory == 'household' ? 'active' : ''}">ìƒí™œì¡í™”</a></li>
    </ul>
</nav>


<main>
    <section class="product-section">
        <div class="product-grid">
            <div th:each="product : ${products}" class="product-card">
                <!-- âœ… ì ˆëŒ€ URL(https://)ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©, ë¡œì»¬ ì´ë¯¸ì§€ë©´ /img/ ì¶”ê°€ -->
                <img th:src="${#strings.contains(product.productImages, 'http')
                              ? product.productImages
                              : '/img/' + product.productImages}"
                     th:alt="${product.productNames}" class="product-img">

                <p class="product-name">[[${product.productNames}]]</p>
                <p class="product-price">[[${product.productPrices}]] ì›</p>
                <p class="product-discount">í• ì¸ ì •ë³´: [[${product.discountInfo}]]</p>
            </div>
        </div>
    </section>
</main>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const productGrid = document.querySelector('.product-grid');

        // âœ… ìƒí’ˆ ì •ë³´ê°€ ìˆì„ ê²½ìš° ë Œë”ë§
        function renderProducts(products) {
            productGrid.innerHTML = ''; // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');

                // âœ… ì´ë¯¸ì§€ ê²½ë¡œ ì²˜ë¦¬ (ì ˆëŒ€ URLê³¼ ë¡œì»¬ ì´ë¯¸ì§€ êµ¬ë¶„)
                const imageUrl = product.productImages.startsWith('http') ? product.productImages : `/img/${product.productImages}`;

                // âœ… í• ì¸ ì •ë³´ í™•ì¸
                const discountInfo = product.discountInfo && product.discountInfo.trim() !== '' ? product.discountInfo : 'í• ì¸ ì—†ìŒ';

                productCard.innerHTML = `
                <img src="${imageUrl}" alt="${product.productNames}" class="product-img">
                <p class="product-name">${product.productNames}</p>
                <p class="product-price">${product.productPrices} ì›</p>
                <p class="product-discount">í• ì¸ ì •ë³´: ${discountInfo}</p>
            `;

                // âœ… ìƒí’ˆ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™
                productCard.addEventListener('click', () => {
                    window.location.href = `/product/${product.barcode}`;
                });

                productGrid.appendChild(productCard);
            });
        }

        // âœ… ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì™€ì„œ ë Œë”ë§ (AJAX ì‚¬ìš© ê°€ëŠ¥)
        function loadProducts() {
            fetch(window.location.pathname) // í˜„ì¬ URLì—ì„œ ë°ì´í„° ê°€ì ¸ì˜´
                .then(response => response.json()) // JSON ë³€í™˜
                .then(data => {
                    renderProducts(data);
                })
                .catch(error => console.error("ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error));
        }

        // âœ… ì´ˆê¸° ìƒí’ˆ ë¡œë“œ
        loadProducts();
    });

</script>

</body>
</html>